---
title: "Module 8"
author: "Rbots"
date: '2022-11-30'
output: html_document
bibliography: BIOL3140.bib
---
# Introduction 
Trans-Gulf migrants are bird species that fly non-stop over the Gulf of Mexico and arrive on land between Texas and Florida. The date when these individuals arrive has important fitness consequences and now need to be shifted in a changing climate. Trans-Gulf migrants must now shift their arrival data at breeding areas in response to warmer spring temperatures or their populations may decline. There has been significant evidence for advanced spring arrival dates in coordination with warmer temperatures at the arrival destination [sparks2007consistent]. Climate change has the potential to further increase temperatures and cause even earlier arrival times. In recent decades, citizen science has become more popularized as public interest in species conservation has also increased. The Cornell Laboratory of Ornithology and the National Audubon Society have established eBird which amateur birders can use to submit their bird observations. This project uses eBird and meteorological data to study the effect of local weather conditions on the arrival time of Trans-Gulf migrants in Massachusetts.

# Methods 
The first thing we had to do for our project was to select 5 different trans-Gulf migrants (TGM). We made sure to pick species which were members of different families of birds. The 5 species we chose were the *Purple Martin* (Progne subis), the *Scarlet Tanager* (Piranga olivacea), the *Palm Warbler* (Setophaga palmarum), the *Baltimore Oriole* (Icterus galbula), and the *Eastern Kingbird* (Tyrannus tyrannus). The data for these birds and their flight paths were obtained from the eBird database compiled by the Cornell lab of Ornithology. In order to collect the data for our birds, we iterated the 5 species of birds we have through the occ_data() function from rgbif. With this data, we were able to determine the Julian day for each species and analyze the effect that temperature and wind had on the migration route of these various birds to Massachusetts. Professor Kenaley chose three locations along the migration route to use as pointers in this analysis. The locations he chose, which we maintained for the experiment, included Mobile, Alabama, Charlotte, North Carolina, and Boston, Massachusetts. They works as a good path, with Mobile leading the way and Boston as the destination. We requested a token from the NOAA website and used this to access and download the data. We, then, plotted the eBird data. First we plotted the proportion of the population that has arrived and the predicted time of arrival for each of the various species. The next plot we conducted was to show the change in Julian days over the years from 2000 to 2019. This change in arrival date shows the effect of climate change over time, because we can directly see how changes in climate are impacting the date in which species arrive back in Boston. We used official weather data to calculate the wind direction results. We used the frollmean() function to calculate the average of the weather variables 5 days before the arrival day and 10 days before the arrival day. Finally, we used a Linear Mixed-effect Model for both sets of weather data, ran an Anova test to determine the best fit model, and model tested with dredge().

# Results
```{r}
library(rgbif)
library(tidyverse)
library(MuMIn)
library(rnoaa)
library(ggmap)
library(usmap)
library(magick)
library(cowplot)
library(lme4)
library(car)
library(rsconnect)
library(curl)
library(data.table)
library(knitr)
library(rgdal)
```

```{r, cache=TRUE} 
#We set this code chunk to cache=TRUE, because the code took a significant amount of time to run, and we wanted to prevent having to run it over and over. Instead, the cache remembers the code unless we make a change!
species <- c("Progne subis","Piranga olivacea","Setophaga palmarum","Icterus galbula","Tyrannus tyrannus")
y <- paste0("2000",",","2019") #In the Additional Operations and Analyses section, we are asked to analyze our species from 2000-2019 
m <- paste0("4",",","5") #In the Additional Operations and Analyses section, we are asked to analyze our species during April and May which correspond to the months 4 and 5 
dat.l <-list()
for(s in species){
n.obs <-  occ_data(scientificName = s,year=y,month=m,limit=0,country="US",basisOfRecord = "HUMAN_OBSERVATION",stateProvince="Massachusetts")$meta$count 
print(n.obs)
dat.l[[paste0(s)]] <- occ_data(scientificName = s,year=y,month=m,
                               limit=n.obs,country="US",
                               basisOfRecord = "HUMAN_OBSERVATION",
                               stateProvince="Massachusetts")[[2]]
}
#This is where the code stopped for Tori last time!
dat <- rbindlist(dat.l,fill=T)
head(dat)
saveRDS(data,"massbird.data.RDS")
```

```{r}
dat <- readRDS("massbird.data.RDS")
dat%>%
  group_by(year,species)%>%
  summarise(count=sum(individualCount,na.rm = T))%>%
  ggplot(aes(x=year,y=count,col=species))+geom_point()
```

We successfully loaded the species occurrence data in from GBIFâ€™s API, and used this graph to visualize the data we have. The graph above allows us to see the amount of data we have, with the dependency of count of species data on the year in the time range requested (Between April and May in 2000-2019).

```{r, cache=TRUE}
#We set this code chunk to cache=TRUE, because the code took a significant amount of time to run, and we wanted to prevent having to run it over and over. Instead, the cache remembers the code unless we make a change!
options(noaakey = "RrJIqfCapgshUXBCJlyjYvYxZEctURiq")
sts <- c(
  "GHCND:USW00013894", #Mobible, AL 2k away about 10 days away @200 km/day
  "GHCND:USW00013881", #Charlotte, NC 1000 km away about 6 days away @200 km/day
  "GHCND:USW00014739" #Boston
)
sta.d <- bind_rows(#bind the rows 
  lapply(sts,function(x) ncdc_stations(stationid = x)$data))%>%
  mutate(usmap_transform(.,input_names = c("longitude","latitude"),output_names = c("longitude.1", "latitude.1")))%>% #join transformation of lat/long for projection with usmap
  mutate(name=str_sub(name, -5,-4))%>% #simplify the name column, grab just the state
  mutate(migr.day=c(10,5,0))%>% #so we can look at wind speed 0, 5 or 10 days before arrive in boston
  separate(id,into = c("station.type","id"))%>% #need to cut station type out from station id number
```

```{r}
plot_usmap(
  include = c(.northeast_region,.south_region,.east_north_central)
)+geom_point(data=sta.d,aes(x=longitude.1,y=latitude.1,col=name),size=5)+geom_label(data=sta.d,aes(x=longitude.1,y=latitude.1,col=name,label=name),size=5,nudge_x = 1e6*0.25)+theme(legend.position = "none")
```

The map above shows the three locations from which we are collecting weather data as a visual representation of the distance between the stations.

```{r, cache=TRUE}
#We set this code chunk to cache=TRUE, because the code took a significant amount of time to run, and we wanted to prevent having to run it over and over. Instead, the cache remembers the code unless we make a change!
weather.d <- meteo_pull_monitors(sta.d$id,date_min = "2000-01-01")
```

```{r}
tot.dat<- dat%>%
  group_by(year)%>%
  mutate(date=as.Date(paste0(year,"-",month,"-",day)),
         j.day=julian(date,origin=as.Date(paste0(unique(year),"-01-01")))
  )%>%
  group_by(species,year,j.day,date)%>%
  summarise(day.tot=sum(individualCount,na.rm=T))%>%
  group_by(species,year)%>%
  mutate(prop=cumsum(day.tot/sum(day.tot,na.rm = T)))%>%
  filter(year>1999)
tot.dat%>%
  ggplot(aes(j.day,prop,color=species))+geom_point()+facet_wrap(year~.)
```

The above graph shows the arrival of each of the species we chose during the period of 2000 through 2019. It's filtered for the months of April and May as well. To analyze this data, species used to categorized the data and logistic models modeled arrival data and estimated the arrival function. 

```{r}
weather.d <- weather.d%>%
  mutate(year=as.integer(str_sub(date,1,4)), #add year
         date=as.Date(date))%>%
  group_by(year)%>% #group by year so we can compute julian day
 mutate(j.day=julian(date,origin=as.Date(paste0(unique(year),"-01-01"))), #add julian day
  date2=date,
  wdir.rad=(180-abs(wdf2-180))*pi/180, #radians so we can use a trig function to compute wind vector, scale degrees first to 180 scale to 2x pi and subtract from 180 (wind comes out of a direction)
  wvec=cos(wdir.rad)*-1*awnd # we want a negative value for positive value for 2x pi
  )%>% #store day in new column
  dplyr::select(id,year,date2,j.day,tmin,tmax,wvec)%>% #select the rows we need
  left_join(sta.d%>%select(id,name,migr.day))%>% #add the station id info (ie. name)
  mutate(j.day=j.day+migr.day)#make j.day ahead of BOS according to the migration days away so we can join weather along path
```

```{r, fig.height=5, fig.width=5, cache=TRUE,fig.cap="Progne subis or The Purple Martin"}
#Progne subis or The Purple Martin
ps<- dat%>%
  filter(species=="Progne subis")%>%
  group_by(year)%>%
  mutate(date=as.Date(paste0(year,"-",month,"-",day)),
         j.day=julian(date,origin=as.Date(paste0(unique(year),"-01-01")))
  )%>%
  group_by(species,year,j.day,date)%>%
  summarise(day.tot=sum(individualCount,na.rm=T))%>%
  group_by(species,year)%>%
  mutate(prop=cumsum(day.tot/sum(day.tot,na.rm = T)))%>%
  filter(year>1999)
ps.pred <- ps%>%
  group_by(year)%>%
  summarize(
    pred=predict(nls(prop~SSlogis(j.day,Asym, xmid, scal)),newdata=data.frame(j.day=min(j.day):max(j.day))),#predict the logistic curve for each species
    j.day=min(j.day):max(j.day),
  )%>%
  left_join(ps%>%dplyr::select(j.day,date)) ## add date back to tibble
ps%>%
  ggplot(aes(j.day,prop))+geom_point(aes=0.3)+geom_line(data=ps.pred,aes(x=j.day,y=pred),col="darkgoldenrod2",size=2)+facet_wrap(year~.)
```

```{r, fig.height=5, fig.width=5, cache=TRUE, fig.cap="The Scarlet Tanager"}
#Piranga olivacea or The Scarlet Tanager
st<- dat%>%
  filter(species=="Piranga olivacea")%>%
  group_by(year)%>%
  mutate(date=as.Date(paste0(year,"-",month,"-",day)),
         j.day=julian(date,origin=as.Date(paste0(unique(year),"-01-01")))
  )%>%
  group_by(species,year,j.day,date)%>%
  summarise(day.tot=sum(individualCount,na.rm=T))%>%
  group_by(species,year)%>%
  mutate(prop=cumsum(day.tot/sum(day.tot,na.rm = T)))%>%
  filter(year>1999)
st.pred <- st%>%
  group_by(year)%>%
  summarize(
    pred=predict(nls(prop~SSlogis(j.day,Asym, xmid, scal)),newdata=data.frame(j.day=min(j.day):max(j.day))),#predict the logistic curve for each species
    j.day=min(j.day):max(j.day),
  )%>%
  left_join(st%>%dplyr::select(j.day,date)) ## add date back to tibble
st%>%
  ggplot(aes(j.day,prop))+geom_point(aes=0.3)+geom_line(data=st.pred,aes(x=j.day,y=pred),col="deepskyblue1",size=2)+facet_wrap(year~.)
```

```{r, fig.height=5, fig.width=5, cache=TRUE, fig.cap="The Palm Warbler"}
#Setophaga palmarum or The Palm Warbler
pw<- dat%>%
  filter(species=="Setophaga palmarum")%>%
  group_by(year)%>%
  mutate(date=as.Date(paste0(year,"-",month,"-",day)),
         j.day=julian(date,origin=as.Date(paste0(unique(year),"-01-01")))
  )%>%
  group_by(species,year,j.day,date)%>%
  summarise(day.tot=sum(individualCount,na.rm=T))%>%
  group_by(species,year)%>%
  mutate(prop=cumsum(day.tot/sum(day.tot,na.rm = T)))%>%
  filter(year>1999)
pw.pred <- pw%>%
  group_by(year)%>%
  summarize(
    pred=predict(nls(prop~SSlogis(j.day,Asym, xmid, scal)),newdata=data.frame(j.day=min(j.day):max(j.day))),#predict the logistic curve for each species
    j.day=min(j.day):max(j.day),
  )%>%
  left_join(pw%>%dplyr::select(j.day,date)) ## add date back to tibble
pw%>%
  ggplot(aes(j.day,prop))+geom_point(aes=0.3)+geom_line(data=pw.pred,aes(x=j.day,y=pred),col="chartreuse3",size=2)+facet_wrap(year~.)
```

```{rfig.height=5, fig.width=5, cache=TRUE,fig.cap="The Baltimore Oriole"}
#Icterus galbula or The Baltimore Oriole
bo<- dat%>%
  filter(species=="Icterus galbula")%>%
  group_by(year)%>%
  mutate(date=as.Date(paste0(year,"-",month,"-",day)),
         j.day=julian(date,origin=as.Date(paste0(unique(year),"-01-01")))
  )%>%
  group_by(species,year,j.day,date)%>%
  summarise(day.tot=sum(individualCount,na.rm=T))%>%
  group_by(species,year)%>%
  mutate(prop=cumsum(day.tot/sum(day.tot,na.rm = T)))%>%
  filter(year>1999)
bo.pred <- bo%>%
  group_by(year)%>%
  summarize(
    pred=predict(nls(prop~SSlogis(j.day,Asym, xmid, scal)),newdata=data.frame(j.day=min(j.day):max(j.day))),#predict the logistic curve for each species
    j.day=min(j.day):max(j.day),
  )%>%
  left_join(bo%>%dplyr::select(j.day,date)) ## add date back to tibble
bo%>%
  ggplot(aes(j.day,prop))+geom_point(aes=0.3)+geom_line(data=bo.pred,aes(x=j.day,y=pred),col="darkred",size=2)+facet_wrap(year~.)
```

```{r, fig.height=5, fig.width=5, cache=TRUE,fig.cap="The Eastern Kingbird"}
#Tyrannus tyrannus or The Eastern Kingbird
ek<- dat%>%
  filter(species=="Megaceryle alcyon")%>%
  group_by(year)%>%
  mutate(date=as.Date(paste0(year,"-",month,"-",day)),
         j.day=julian(date,origin=as.Date(paste0(unique(year),"-01-01")))
  )%>%
  group_by(species,year,j.day,date)%>%
  summarise(day.tot=sum(individualCount,na.rm=T))%>%
  group_by(species,year)%>%
  mutate(prop=cumsum(day.tot/sum(day.tot,na.rm = T)))%>%
  filter(year>1999)
ek.pred <- ek%>%
  group_by(year)%>%
  summarize(
    pred=predict(nls(prop~SSlogis(j.day,Asym, xmid, scal)),newdata=data.frame(j.day=min(j.day):max(j.day))),#predict the logistic curve for each species
    j.day=min(j.day):max(j.day),
  )%>%
  left_join(ek%>%dplyr::select(j.day,date)) ## add date back to tibble
ek%>%
  ggplot(aes(j.day,prop))+geom_point(aes=0.3)+geom_line(data=ek.pred,aes(x=j.day,y=pred),col="coral1",size=2)+facet_wrap(year~.)
```

CAPTION

```{r, fig.height=5, fig.width=5, cache=TRUE, fig.cap="The Purple Martin"}
#Progne subis or The Purple Martin
ps.arrive.date <-ps.pred%>%
  group_by(year)%>%
  filter(j.day==j.day[which.min(abs(pred-0.25))])
ps.arrive.date%>%
  ggplot(aes(year,j.day))+geom_point()
```

```{r, fig.height=5, fig.width=5, cache=TRUE, fig.cap="The Scarlet Tanager"}
#Piranga olivacea or The Scarlet Tanager
st.arrive.date <-st.pred%>%
  group_by(year)%>%
  filter(j.day==j.day[which.min(abs(pred-0.25))])
st.arrive.date%>%
  ggplot(aes(year,j.day))+geom_point()
```

```{r, fig.height=5, fig.width=5, cache=TRUE, fig.cap="The Palm Warbler"}
#Setophaga palmarum or The Palm Warbler
pw.arrive.date <-pw.pred%>%
  group_by(year)%>%
  filter(j.day==j.day[which.min(abs(pred-0.25))])
pw.arrive.date%>%
  ggplot(aes(year,j.day))+geom_point()
```

```{r, fig.height=5, fig.width=5, cache=TRUE, fig.cap="The Baltimore Oriole"}
#Icterus galbula or The Baltimore Oriole
bo.arrive.date <-bo.pred%>%
  group_by(year)%>%
  filter(j.day==j.day[which.min(abs(pred-0.25))])
bo.arrive.date%>%
  ggplot(aes(year,j.day))+geom_point()
```

```{r, fig.height=5, fig.width=5, cache=TRUE, fig.cap="The Eastern Kingbird"}
#Tyrannus tyrannus or The Eastern Kingbird
ek.arrive.date <-ek.pred%>%
  group_by(year)%>%
  filter(j.day==j.day[which.min(abs(pred-0.25))])
ek.arrive.date%>%
  ggplot(aes(year,j.day))+geom_point()
```

For each of the species we analyzed, the results that we found from this data do not show much of a pattern between the arrival date from year to year, so we will determine how weather might have an effect on the migration pattern of the species annually.

```{r}
#Progne subis or The Purple Martin
pm.arr.weath <- pm.arrive.date%>%
  left_join(weather.d)%>%
  left_join(pm%>%dplyr::select(year,date,j.day))
#Piranga olivacea or The Scarlet Tanager 
st.arr.weath <- st.arrive.date%>%
  left_join(weather.d)%>%
  left_join(st%>%dplyr::select(year,date,j.day))
#Setophaga palmarum or The Palm Warbler 
pw.arr.weath <- pw.arrive.date%>%
  left_join(weather.d)%>%
  left_join(pw%>%dplyr::select(year,date,j.day))
#Icterus galbula or The Baltimore Oriole 
bo.arr.weath <- bo.arrive.date%>%
  left_join(weather.d)%>%
  left_join(bo%>%dplyr::select(year,date,j.day))
#Tyrannus tyrannus or The Eastern Kingbird
ek.arr.weath <- ek.arrive.date%>%
  left_join(weather.d)%>%
  left_join(ek%>%dplyr::select(year,date,j.day))
```

```{r}
weather.wk <-weather.d %>% 
  group_by(year,name) %>% 
  mutate(wk.tmin = frollmean(tmin, n=14,align="right"),
         wk.tmax = frollmean(tmax, n=14,align="right"),
         wk.wvec = frollmean(wvec, n=14,align="right")
  )%>%
  dplyr::select(j.day,date2,name,wk.tmin,wk.tmax,wk.wvec)
```

```{r}
pm.arr.weath2 <- mea.arrive.date%>%
  left_join(weather.wk)
st.arr.weath2 <- ep.arrive.date%>%
  left_join(weather.wk)
pw.arr.weath2 <- pv.arrive.date%>%
  left_join(weather.wk)
bo.arr.weath2 <- st.arrive.date%>%
  left_join(weather.wk)
ek.arr.weath2 <- btw.arrive.date%>%
  left_join(weather.wk)
```

```{r}
pm.lmer <- lmer(j.day~tmin*tmax*wvec+(1|name),pm.arr.weath,na.action = "na.fail")
anova.pm <- Anova(pm.lmer)
kable(anova.pm,caption= "Purple Martin")
st.lmer <- lmer(j.day~tmin*tmax*wvec+(1|name),st.arr.weath,na.action = "na.fail")
anova.st <- Anova(st.lmer)
kable(anova.st,caption = "Scarlet Tanager")
pw.lmer <- lmer(j.day~tmin*tmax*wvec+(1|name),pw.arr.weath,na.action = "na.fail")
anova.pw <- Anova(pw.lmer)
kable(anova.pw,caption="Palm Warbler")
bo.lmer <- lmer(j.day~tmin*tmax*wvec+(1|name),bo.arr.weath,na.action = "na.fail")
anova.bo <- Anova(bo.lmer)
kable(anova.bo,caption="Baltimore Oriole")
ek.lmer <- lmer(j.day~tmin*tmax*wvec+(1|name),ek.arr.weath,na.action = "na.fail")
anova.ek <- Anova(ek.lmer)
kable(anova.ek,caption="Eastern Kingbird")
yw.lmer <- lmer(j.day~tmin*tmax*wvec+(1|name),yw.arr.weath,na.action = "na.fail")
```

CAPTION

```{r}
pm.lmer2 <- lmer(j.day~wk.tmin*wk.tmax*wk.wvec+(1|name),pm.arr.weath2,na.action = "na.fail")
anova.pm2 <- Anova(pm.lmer2)
kable(anova.pm2,caption = "Purple Martin")
st.lmer2 <- lmer(j.day~wk.tmin*wk.tmax*wk.wvec+(1|name),st.arr.weath2,na.action = "na.fail")
anova.st2 <- Anova(st.lmer2)
kable(anova.st2,caption="Scarlet Tanager")
pw.lmer2 <- lmer(j.day~wk.tmin*wk.tmax*wk.wvec+(1|name),pw.arr.weath2,na.action = "na.fail")
anova.pw2 <- Anova(pw.lmer2)
kable(anova.pw2,caption="Palm Warbler")
bo.lmer2 <- lmer(j.day~wk.tmin*wk.tmax*wk.wvec+(1|name),bo.arr.weath2,na.action = "na.fail")
anova.bo2 <- Anova(bo.lmer2)
kable(anova.bo2,caption="Baltimore Oriole")
ek.lmer2 <- lmer(j.day~wk.tmin*wk.tmax*wk.wvec+(1|name),ek.arr.weath2,na.action = "na.fail")
anova.ek2 <- Anova(ek.lmer2)
kable(anova.ek2,caption="Eastern Kingbird")
```

CAPTION

```{r}
pm.arr.aic1 <- dredge(pm.lmer,fixed = c("tmin","tmax","wvec"),)
kable(pm.arr.aic1[1:4,],caption = "Fit values for nested models of the most complicated lme model for Purple Martin")
st.arr.aic1 <- dredge(st.lmer,fixed = c("tmin","tmax","wvec"),)
kable(st.arr.aic1[1:4,],caption = "Fit values for nested models of the most complicated lme model for Scarlet Tanager")
pw.arr.aic1 <- dredge(pw.lmer,fixed = c("tmin","tmax","wvec"),)
kable(pw.arr.aic1[1:4,],caption = "Fit values for nested models of the most complicated lme model for Palm Warbler")
bo.arr.aic1 <- dredge(bo.lmer,fixed = c("tmin","tmax","wvec"),)
kable(bo.arr.aic1[1:4,],caption = "Fit values for nested models of the most complicated lme model for Baltimore Oriole")
ek.arr.aic1 <- dredge(ek.lmer,fixed = c("tmin","tmax","wvec"),)
kable(ek.arr.aic1[1:4,],caption = "Fit values for nested models of the most complicated lme model for Eastern Kingbird")
```

CAPTION

```{r}
pm.arr.aic <- dredge(pm.lmer2,fixed = c("wk.tmin","wk.tmax","wk.wvec"),)
kable(pm.arr.aic[1:4,],caption = "Fit values for nested models of the most complicated lme model for Purple Martin")
st.arr.aic <- dredge(st.lmer2,fixed = c("wk.tmin","wk.tmax","wk.wvec"),)
kable(st.arr.aic[1:4,],caption = "Fit values for nested models of the most complicated lme model for Scarlet Tanager")
pw.arr.aic <- dredge(pw.lmer2,fixed = c("wk.tmin","wk.tmax","wk.wvec"),)
kable(pw.arr.aic[1:4,],caption = "Fit values for nested models of the most complicated lme model for Palm Warbler")
bo.arr.aic <- dredge(bo.lmer2,fixed = c("wk.tmin","wk.tmax","wk.wvec"),)
kable(bo.arr.aic[1:4,],caption = "Fit values for nested models of the most complicated lme model for Baltimore Oriole")
ek.arr.aic <- dredge(ek.lmer2,fixed = c("wk.tmin","wk.tmax","wk.wvec"),)
kable(ek.arr.aic[1:4,],caption = "Fit values for nested models of the most complicated lme model for Eastern Kingbird")
```

CAPTION

```{r,"best fitting models -- single day data"}
best.pm.lmer1 <-  lmer(j.day~tmin+tmax+wvec+(1|name),pm.arr.weath,na.action = "na.fail")
bestpm1 <- Anova(best.pm.lmer1)
kable(bestpm1,caption="Purple Martin")
best.st.lmer1 <-  lmer(j.day~tmin+tmax+wvec+(1|name),st.arr.weath,na.action = "na.fail")
bestst1 <- Anova(best.st.lmer1)
kable(bestst1,caption="Scarlet Tanager")
best.pw.lmer1 <-  lmer(j.day~tmin+tmax+wvec+(1|name),pw.arr.weath,na.action = "na.fail")
bestpw1 <- Anova(best.pw.lmer1)
kable(bestpw1,caption="Palm Warbler")
best.bo.lmer1 <-  lmer(j.day~tmin+tmax+wvec+(1|name),bo.arr.weath,na.action = "na.fail")
bestbo1 <- Anova(best.bo.lmer1)
kable(bestbo1,caption="Baltimore Oriole")
best.ek.lmer1 <-  lmer(j.day~tmin+tmax+wvec+(1|name),ek.arr.weath,na.action = "na.fail")
bestek1 <- Anova(best.ek.lmer1)
kable(bestek1,caption="Eastern Kingbird")
```

```{r,"best fitting models average weather data"}
best.pm.lmer <-  lmer(j.day~wk.tmin+wk.tmax+wk.wvec+(1|name),pm.arr.weath2,na.action = "na.fail")
bestpm <- Anova(best.pm.lmer)
kable(bestpm,caption="Purple Martin")
best.st.lmer <-  lmer(j.day~wk.tmin+wk.tmax+wk.wvec+(1|name),st.arr.weath2,na.action = "na.fail")
bestst <- Anova(best.st.lmer)
kable(bestst,caption="Scarlet Tanager")
best.pw.lmer <-  lmer(j.day~wk.tmin+wk.tmax+wk.wvec+(1|name),pw.arr.weath2,na.action = "na.fail")
bestpw <- Anova(best.pw.lmer)
kable(bestpw,caption="Palm Warbler")
best.bo.lmer <-  lmer(j.day~wk.tmin+wk.tmax+wk.wvec+(1|name),bo.arr.weath2,na.action = "na.fail")
bestbo <- Anova(best.bo.lmer)
kable(bestbo,caption="Baltimore Oriole")
best.ek.lmer <-  lmer(j.day~wk.tmin+wk.tmax+wk.wvec+(1|name),ek.arr.weath2,na.action = "na.fail")
bestek <- Anova(best.ek.lmer)
kable(bestek,caption="Eastern Kingbird")
```

CAPTIONS

```{r,"additional analysis",cache=TRUE}
#establishing arrival date for estimate of all species logistic model 
all.dat.pred <- all.dat%>%
  group_by(year)%>%
  summarize(
    pred=predict(nls(prop~SSlogis(j.day,Asym, xmid, scal)),newdata=data.frame(j.day=min(j.day):max(j.day))),#predict the logistic curve for each species
    j.day=min(j.day):max(j.day),
  )%>%
  left_join(all.dat%>%dplyr::select(j.day,date)) ## add date back to tibble
alldat.arrive.date <-all.dat.pred%>%
  group_by(year)%>%
  filter(j.day==j.day[which.min(abs(pred-0.25))])
#combining with weater means (staggered bc they're all coming at different times)
alldat.arr.weath <- alldat.arrive.date%>%
  left_join(weather.d)%>%
  left_join(all.dat%>%dplyr::select(year,date,j.day))
alldat.arr.weath2 <- alldat.arrive.date%>%
  left_join(weather.wk)
#linear model 1 
alldat.lmer2 <- lmer(j.day~wk.tmin*wk.tmax*wk.wvec+(1|name)+(1|species),alldat.arr.weath2,na.action = "na.fail")
anova.all <- Anova(alldat.lmer2)
kable(anova.all,caption="ANOVA values for linear model of all 6 species")
#secondary model 
alldat.arr.aic <- dredge(alldat.lmer2,fixed = c("wk.tmin","wk.tmax","wk.wvec"),)
kable(pv.arr.aic[1:4,],caption = "Fit values for nested models of the most complicated lme model for all species")
#all data best model 
best.alldat.lmer <-  lmer(j.day~wk.tmin+wk.tmax+wk.wvec+(1|name)+(1|species),alldat.arr.weath2,na.action = "na.fail")
anova.bestmodel <- Anova(best.alldat.lmer)
kable(anova.bestmodel,caption = "ANOVA values for best fit linear model of all species")
```

DISCUSSION

# Author Contributions
Tori: Introduction
Lexi: Results
Christopher: 
Eugene: Methods

# References
